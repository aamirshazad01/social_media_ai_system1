module.exports=[66037,e=>{"use strict";let t="https://api.linkedin.com/v2",r=["openid","profile","email","w_member_social"];function i(e,t,i){let n=new URLSearchParams({response_type:"code",client_id:e,redirect_uri:t,state:i,scope:r.join(" ")});return`https://www.linkedin.com/oauth/v2/authorization?${n.toString()}`}async function n(e,t,r,i){let n=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:t,client_secret:r,redirect_uri:i}),a=await fetch("https://www.linkedin.com/oauth/v2/accessToken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(!a.ok)throw Error((await a.json()).error_description||"Failed to exchange code for token");return a.json()}async function a(e){let r=await fetch(`${t}/userinfo`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw Error("Failed to fetch LinkedIn profile");return r.json()}async function o(e){let r=await fetch(`${t}/me`,{headers:{Authorization:`Bearer ${e}`,"LinkedIn-Version":"202402"}});if(!r.ok)throw Error("Failed to fetch LinkedIn user URN");return(await r.json()).id}async function s(e,r,i,n="PUBLIC",a){let o={author:`urn:li:person:${r}`,lifecycleState:"PUBLISHED",specificContent:{"com.linkedin.ugc.ShareContent":{shareCommentary:{text:i},shareMediaCategory:a?"IMAGE":"NONE"}},visibility:{"com.linkedin.ugc.MemberNetworkVisibility":n}};a&&(o.specificContent["com.linkedin.ugc.ShareContent"].media=[{status:"READY",media:a}]);let l=await fetch(`${t}/ugcPosts`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0","LinkedIn-Version":"202402"},body:JSON.stringify(o)});if(!l.ok){let e=await l.text();throw Error(`Failed to post to LinkedIn: ${e}`)}return l.json()}async function l(e,r){let i={registerUploadRequest:{recipes:["urn:li:digitalmediaRecipe:feedshare-image"],owner:`urn:li:person:${r}`,serviceRelationships:[{relationshipType:"OWNER",identifier:"urn:li:userGeneratedContent"}]}},n=await fetch(`${t}/assets?action=registerUpload`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0","LinkedIn-Version":"202402"},body:JSON.stringify(i)});if(!n.ok){let e=await n.text();throw Error(`Failed to initialize image upload: ${e}`)}let a=await n.json();return{uploadUrl:a.value.uploadMechanism["com.linkedin.digitalmedia.uploading.MediaUploadHttpRequest"].uploadUrl,asset:a.value.asset}}async function d(e,t,r){if(!(await fetch(e,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/octet-stream"},body:t})).ok)throw Error("Failed to upload image binary to LinkedIn")}async function c(e,r){let i={registerUploadRequest:{recipes:["urn:li:digitalmediaRecipe:feedshare-video"],owner:`urn:li:person:${r}`,serviceRelationships:[{relationshipType:"OWNER",identifier:"urn:li:userGeneratedContent"}]}},n=await fetch(`${t}/assets?action=registerUpload`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0","LinkedIn-Version":"202402"},body:JSON.stringify(i)});if(!n.ok){let e=await n.text();throw Error(`Failed to initialize video upload: ${e}`)}let a=await n.json();return{uploadUrl:a.value.uploadMechanism["com.linkedin.digitalmedia.uploading.MediaUploadHttpRequest"].uploadUrl,asset:a.value.asset}}async function u(e,t,r){if(!(await fetch(e,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/octet-stream"},body:t})).ok)throw Error("Failed to upload video binary to LinkedIn")}e.s(["exchangeCodeForToken",()=>n,"generateLinkedInAuthUrl",()=>i,"getLinkedInProfile",()=>a,"getLinkedInUserUrn",()=>o,"initializeImageUpload",()=>l,"initializeVideoUpload",()=>c,"postToLinkedIn",()=>s,"uploadImageBinary",()=>d,"uploadVideoBinary",()=>u])},13312,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),n=e.i(59756),a=e.i(61916),o=e.i(14444),s=e.i(37092),l=e.i(69741),d=e.i(16795),c=e.i(87718),u=e.i(95169),p=e.i(47587),h=e.i(66012),f=e.i(70101),w=e.i(26937),R=e.i(10372),m=e.i(93695);e.i(52474);var g=e.i(5232),k=e.i(89171),v=e.i(26500),y=e.i(66037);e.i(5891);var E=e.i(56410);async function C(e){try{let t=await (0,v.createServerClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return k.NextResponse.redirect(new URL("/?error=unauthorized",e.url));let{data:i}=await t.from("users").select("workspace_id").eq("id",r.id).maybeSingle();if(!i)return k.NextResponse.redirect(new URL("/?error=no_workspace",e.url));let{searchParams:n}=new URL(e.url),a=n.get("code"),o=n.get("state"),s=n.get("error");if(s)return k.NextResponse.redirect(new URL(`/?error=linkedin_oauth_denied&details=${encodeURIComponent(s)}`,e.url));if(!a||!o)return k.NextResponse.redirect(new URL("/?error=missing_oauth_params",e.url));let l=e.cookies.get("linkedin_oauth_state")?.value;if(!l||l!==o)return k.NextResponse.redirect(new URL("/?error=invalid_state",e.url));let d=process.env.LINKEDIN_CLIENT_ID,c=process.env.LINKEDIN_CLIENT_SECRET;if(!d||!c)return k.NextResponse.redirect(new URL("/?error=linkedin_config_missing",e.url));let u="https://social-medias-os.vercel.app/".replace(/\/$/,"")||"",p=`${u}/api/linkedin/callback`,h=await (0,y.exchangeCodeForToken)(a,d,c,p),f=await (0,y.getLinkedInProfile)(h.access_token),w=await (0,y.getLinkedInUserUrn)(h.access_token),R=new Date(Date.now()+1e3*h.expires_in).toISOString(),m={clientId:d,clientSecret:c,accessToken:h.access_token,refreshToken:h.refresh_token,expiresAt:R,isConnected:!0,profileId:w,profileName:f.name,connectedAt:new Date().toISOString()};await E.CredentialService.savePlatformCredentials("linkedin",m,r.id,i.workspace_id);let g=k.NextResponse.redirect(new URL("/?linkedin_connected=true",e.url));return g.cookies.delete("linkedin_oauth_state"),g}catch(r){console.error("LinkedIn callback error:",r);let t=k.NextResponse.redirect(new URL(`/?error=linkedin_auth_failed&details=${encodeURIComponent(r.message)}`,e.url));return t.cookies.delete("linkedin_oauth_state"),t}}e.s(["GET",()=>C],92646);var _=e.i(92646);let U=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/linkedin/callback/route",pathname:"/api/linkedin/callback",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/linkedin/callback/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:x,workUnitAsyncStorage:I,serverHooks:T}=U;function N(){return(0,i.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:I})}async function S(e,t,i){U.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let k="/api/linkedin/callback/route";k=k.replace(/\/index$/,"")||"/";let v=await U.prepare(e,t,{srcPage:k,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:C,parsedUrl:_,isDraftMode:x,prerenderManifest:I,routerServerContext:T,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,resolvedPathname:P,clientReferenceManifest:A,serverActionsManifest:b}=v,L=(0,l.normalizeAppPath)(k),O=!!(I.dynamicRoutes[L]||I.routes[P]),$=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,_,!1):t.end("This page could not be found"),null);if(O&&!x){let e=!!I.routes[P],t=I.dynamicRoutes[L];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await $();throw new m.NoFallbackError}}let M=null;!O||U.isDev||x||(M="/index"===(M=P)?"/":M);let D=!0===U.isDev||!O,H=O&&!D;b&&A&&(0,o.setReferenceManifestsSingleton)({page:k,clientReferenceManifest:A,serverActionsManifest:b,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:b})});let q=e.method||"GET",j=(0,a.getTracer)(),F=j.getActiveScopeSpan(),B={params:E,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>U.onRequestError(e,t,i,T)},sharedContext:{buildId:y}},z=new d.NodeNextRequest(e),V=new d.NodeNextResponse(t),K=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let o=async e=>U.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${q} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${k}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&N&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!O)return await (0,h.sendResponse)(z,V,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,i=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},T),t}},c=await U.handleResponse({req:e,nextConfig:C,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:s});if(!O)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&O||u.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,w.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(z,V,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};F?await l(F):await j.withPropagatedContext(e.headers,()=>j.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${k}`,kind:a.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof m.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:L,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})}),O)throw t;return await (0,h.sendResponse)(z,V,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>N,"routeModule",()=>U,"serverHooks",()=>T,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>I],13312)},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))},51133,e=>{e.v(e=>Promise.resolve().then(()=>e(22109)))}];

//# sourceMappingURL=_430e3a45._.js.map