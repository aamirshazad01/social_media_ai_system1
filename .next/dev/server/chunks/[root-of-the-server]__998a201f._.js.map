{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/server.ts"],"sourcesContent":["/**\r\n * Supabase Server Client\r\n * Use this client in server components, API routes, and server actions\r\n */\r\n\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport type { Database } from './types'\r\n\r\nexport async function createClient() {\n  const cookieStore = await cookies()\n\r\n  return createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value\r\n        },\r\n        set(name: string, value: string, options: CookieOptions) {\r\n          try {\r\n            cookieStore.set({ name, value, ...options })\r\n          } catch (error) {\r\n            // Handle cookie errors (happens in Server Components)\r\n          }\r\n        },\r\n        remove(name: string, options: CookieOptions) {\r\n          try {\r\n            cookieStore.set({ name, value: '', ...options })\r\n          } catch (error) {\r\n            // Handle cookie errors\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\n}\n\n// Alias to match existing imports in API routes\nexport { createClient as createServerClient }\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAED;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACrD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAO,OAAO;gBACd,sDAAsD;gBACxD;YACF;YACA,QAAO,IAAY,EAAE,OAAsB;gBACzC,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;oBAAC;gBAChD,EAAE,OAAO,OAAO;gBACd,uBAAuB;gBACzB;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/index.ts/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const createBrowserClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call createBrowserClient() from the server but createBrowserClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts <module evaluation>\",\n    \"createBrowserClient\",\n);\nexport const supabase = registerClientReference(\n    function() { throw new Error(\"Attempted to call supabase() from the server but supabase is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts <module evaluation>\",\n    \"supabase\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,0QAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,2DACA;AAEG,MAAM,WAAW,IAAA,0QAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,2DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/index.ts/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const createBrowserClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call createBrowserClient() from the server but createBrowserClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts\",\n    \"createBrowserClient\",\n);\nexport const supabase = registerClientReference(\n    function() { throw new Error(\"Attempted to call supabase() from the server but supabase is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts\",\n    \"supabase\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,0QAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,uCACA;AAEG,MAAM,WAAW,IAAA,0QAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,uCACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/auth/encryptionManager.ts"],"sourcesContent":["/**\r\n * Server-side Encryption Manager\r\n * Handles all encryption/decryption operations\r\n * Keys are NEVER sent to client\r\n * Uses Node.js crypto module for secure operations\r\n */\r\n\r\nimport crypto from 'crypto'\r\n\r\n/**\r\n * Get or create workspace encryption key\r\n * Derives a key from master secret + workspace ID\r\n */\r\nexport async function getOrCreateWorkspaceEncryptionKey(\r\n  workspaceId: string\r\n): Promise<Buffer> {\r\n  try {\r\n    const masterSecret = process.env.ENCRYPTION_MASTER_KEY\r\n\r\n    if (!masterSecret) {\r\n      throw new Error('ENCRYPTION_MASTER_KEY environment variable not set')\r\n    }\r\n\r\n    // Derive a workspace-specific key using PBKDF2\r\n    const key = crypto.pbkdf2Sync(\r\n      masterSecret, // password\r\n      workspaceId, // salt\r\n      100000, // iterations\r\n      32, // keylen (256 bits for AES-256)\r\n      'sha256'\r\n    )\r\n\r\n    return key\r\n  } catch (error) {\r\n    console.error('Failed to get workspace encryption key:', error)\r\n    throw new Error('Encryption key unavailable')\r\n  }\r\n}\r\n\r\n/**\r\n * Encrypt credentials using AES-256-GCM\r\n * Returns base64-encoded string with IV + ciphertext\r\n */\r\nexport async function encryptCredentials(\r\n  credentials: any,\r\n  encryptionKey: Buffer\r\n): Promise<string> {\r\n  try {\r\n    const data = JSON.stringify(credentials)\r\n\r\n    // Generate random IV (12 bytes for GCM)\r\n    const iv = crypto.randomBytes(12)\r\n\r\n    // Create cipher\r\n    const cipher = crypto.createCipheriv('aes-256-gcm', encryptionKey, iv)\r\n\r\n    // Encrypt data\r\n    let encrypted = cipher.update(data, 'utf8', 'hex')\r\n    encrypted += cipher.final('hex')\r\n\r\n    // Get authentication tag\r\n    const authTag = cipher.getAuthTag()\r\n\r\n    // Combine IV + authTag + encrypted data\r\n    const combined = Buffer.concat([iv, authTag, Buffer.from(encrypted, 'hex')])\r\n\r\n    // Return as base64\r\n    return combined.toString('base64')\r\n  } catch (error) {\r\n    console.error('Encryption failed:', error)\r\n    throw new Error('Failed to encrypt credentials')\r\n  }\r\n}\r\n\r\n/**\r\n * Decrypt credentials using AES-256-GCM\r\n */\r\nexport async function decryptCredentials(\r\n  encryptedData: string,\r\n  encryptionKey: Buffer\r\n): Promise<any> {\r\n  try {\r\n    // Decode from base64\r\n    const combined = Buffer.from(encryptedData, 'base64')\r\n\r\n    // Extract IV (first 12 bytes), authTag (next 16 bytes), and ciphertext\r\n    const iv = combined.slice(0, 12)\r\n    const authTag = combined.slice(12, 28)\r\n    const ciphertext = combined.slice(28)\r\n\r\n    // Create decipher\r\n    const decipher = crypto.createDecipheriv('aes-256-gcm', encryptionKey, iv)\r\n\r\n    // Set authentication tag\r\n    decipher.setAuthTag(authTag)\r\n\r\n    // Decrypt\r\n    let decrypted = decipher.update(ciphertext.toString('hex'), 'hex', 'utf8')\r\n    decrypted += decipher.final('utf8')\r\n\r\n    return JSON.parse(decrypted)\r\n  } catch (error) {\r\n    console.error('Decryption failed:', error)\r\n    throw new Error('Failed to decrypt credentials')\r\n  }\r\n}\r\n\r\n/**\r\n * Hash a value using SHA-256\r\n */\r\nexport function hashValue(value: string): string {\r\n  return crypto.createHash('sha256').update(value).digest('hex')\r\n}\r\n\r\n/**\r\n * Generate random bytes\r\n */\r\nexport function generateRandomBytes(length: number = 32): string {\r\n  return crypto.randomBytes(length).toString('hex')\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;AAED;;AAMO,eAAe,kCACpB,WAAmB;IAEnB,IAAI;QACF,MAAM,eAAe,QAAQ,GAAG,CAAC,qBAAqB;QAEtD,IAAI,CAAC,cAAc;YACjB,MAAM,IAAI,MAAM;QAClB;QAEA,+CAA+C;QAC/C,MAAM,MAAM,gHAAM,CAAC,UAAU,CAC3B,cACA,aACA,QACA,IACA;QAGF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;QACzD,MAAM,IAAI,MAAM;IAClB;AACF;AAMO,eAAe,mBACpB,WAAgB,EAChB,aAAqB;IAErB,IAAI;QACF,MAAM,OAAO,KAAK,SAAS,CAAC;QAE5B,wCAAwC;QACxC,MAAM,KAAK,gHAAM,CAAC,WAAW,CAAC;QAE9B,gBAAgB;QAChB,MAAM,SAAS,gHAAM,CAAC,cAAc,CAAC,eAAe,eAAe;QAEnE,eAAe;QACf,IAAI,YAAY,OAAO,MAAM,CAAC,MAAM,QAAQ;QAC5C,aAAa,OAAO,KAAK,CAAC;QAE1B,yBAAyB;QACzB,MAAM,UAAU,OAAO,UAAU;QAEjC,wCAAwC;QACxC,MAAM,WAAW,OAAO,MAAM,CAAC;YAAC;YAAI;YAAS,OAAO,IAAI,CAAC,WAAW;SAAO;QAE3E,mBAAmB;QACnB,OAAO,SAAS,QAAQ,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,mBACpB,aAAqB,EACrB,aAAqB;IAErB,IAAI;QACF,qBAAqB;QACrB,MAAM,WAAW,OAAO,IAAI,CAAC,eAAe;QAE5C,uEAAuE;QACvE,MAAM,KAAK,SAAS,KAAK,CAAC,GAAG;QAC7B,MAAM,UAAU,SAAS,KAAK,CAAC,IAAI;QACnC,MAAM,aAAa,SAAS,KAAK,CAAC;QAElC,kBAAkB;QAClB,MAAM,WAAW,gHAAM,CAAC,gBAAgB,CAAC,eAAe,eAAe;QAEvE,yBAAyB;QACzB,SAAS,UAAU,CAAC;QAEpB,UAAU;QACV,IAAI,YAAY,SAAS,MAAM,CAAC,WAAW,QAAQ,CAAC,QAAQ,OAAO;QACnE,aAAa,SAAS,KAAK,CAAC;QAE5B,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,SAAS,UAAU,KAAa;IACrC,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,OAAO,MAAM,CAAC;AAC1D;AAKO,SAAS,oBAAoB,SAAiB,EAAE;IACrD,OAAO,gHAAM,CAAC,WAAW,CAAC,QAAQ,QAAQ,CAAC;AAC7C","debugId":null}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/services/database/auditLogService.ts"],"sourcesContent":["/**\r\n * Audit Log Service\r\n * Logs all credential-related events for compliance and debugging\r\n */\r\n\r\nimport { supabase } from '@/lib/supabase'\r\nimport type { Platform } from '@/types'\r\n\r\nexport interface AuditEventParams {\r\n  workspaceId: string\r\n  userId: string\r\n  platform: Platform\r\n  action: string\r\n  status: 'success' | 'failed' | 'partial'\r\n  errorMessage?: string\r\n  errorCode?: string\r\n  ipAddress?: string\r\n  userAgent?: string\r\n  requestPath?: string\r\n  metadata?: any\r\n}\r\n\r\n/**\r\n * Log an audit event\r\n */\r\nexport async function logAuditEvent({\r\n  workspaceId,\r\n  userId,\r\n  platform,\r\n  action,\r\n  status,\r\n  errorMessage,\r\n  errorCode,\r\n  ipAddress,\r\n  userAgent,\r\n  requestPath,\r\n  metadata,\r\n}: AuditEventParams): Promise<void> {\r\n  try {\r\n    const { error } = await supabase.from('credential_audit_log').insert({\r\n      workspace_id: workspaceId,\r\n      user_id: userId,\r\n      platform,\r\n      action,\r\n      status,\r\n      error_message: errorMessage || null,\r\n      error_code: errorCode || null,\r\n      ip_address: ipAddress || null,\r\n      user_agent: userAgent || null,\r\n      request_path: requestPath || null,\r\n      metadata: metadata || null,\r\n    } as any)\r\n\r\n    if (error) {\r\n      console.error('Failed to insert audit log:', error)\r\n    }\r\n  } catch (error) {\r\n    console.error('Audit logging error:', error)\r\n    // Don't throw - logging failures shouldn't break the app\r\n  }\r\n}\r\n\r\n/**\r\n * Get audit logs for a workspace\r\n */\r\nexport async function getAuditLogs(\r\n  workspaceId: string,\r\n  filters?: {\r\n    platform?: Platform\r\n    action?: string\r\n    status?: string\r\n    limit?: number\r\n    offset?: number\r\n    startDate?: Date\r\n    endDate?: Date\r\n  }\r\n): Promise<any[]> {\r\n  try {\r\n    let query = supabase\r\n      .from('credential_audit_log')\r\n      .select('*')\r\n      .eq('workspace_id', workspaceId)\r\n      .order('created_at', { ascending: false })\r\n\r\n    if (filters?.platform) {\r\n      query = query.eq('platform', filters.platform)\r\n    }\r\n\r\n    if (filters?.action) {\r\n      query = query.eq('action', filters.action)\r\n    }\r\n\r\n    if (filters?.status) {\r\n      query = query.eq('status', filters.status)\r\n    }\r\n\r\n    if (filters?.startDate) {\r\n      query = query.gte('created_at', filters.startDate.toISOString())\r\n    }\r\n\r\n    if (filters?.endDate) {\r\n      query = query.lte('created_at', filters.endDate.toISOString())\r\n    }\r\n\r\n    const limit = Math.min(filters?.limit || 100, 1000) // Cap at 1000\r\n    const offset = filters?.offset || 0\r\n\r\n    query = query.range(offset, offset + limit - 1)\r\n\r\n    const { data, error } = await query\r\n\r\n    if (error) throw error\r\n    return data || []\r\n  } catch (error) {\r\n    console.error('Error fetching audit logs:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get audit logs for a specific user\r\n */\r\nexport async function getUserAuditLogs(\r\n  workspaceId: string,\r\n  userId: string,\r\n  options?: {\r\n    limit?: number\r\n    offset?: number\r\n  }\r\n): Promise<any[]> {\r\n  try {\r\n    let query = supabase\r\n      .from('credential_audit_log')\r\n      .select('*')\r\n      .eq('workspace_id', workspaceId)\r\n      .eq('user_id', userId)\r\n      .order('created_at', { ascending: false })\r\n\r\n    const limit = Math.min(options?.limit || 50, 500)\r\n    const offset = options?.offset || 0\r\n\r\n    query = query.range(offset, offset + limit - 1)\r\n\r\n    const { data, error } = await query\r\n\r\n    if (error) throw error\r\n    return data || []\r\n  } catch (error) {\r\n    console.error('Error fetching user audit logs:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get summary of credential activities\r\n */\r\nexport async function getAuditSummary(\r\n  workspaceId: string,\r\n  days: number = 7\r\n): Promise<{\r\n  totalConnections: number\r\n  totalDisconnections: number\r\n  totalRefreshes: number\r\n  totalFailures: number\r\n  platformStats: Record<string, any>\r\n  recentActivity: any[]\r\n}> {\r\n  try {\r\n    const startDate = new Date()\r\n    startDate.setDate(startDate.getDate() - days)\r\n\r\n    const logs = await getAuditLogs(workspaceId, {\r\n      startDate,\r\n      limit: 1000,\r\n    })\r\n\r\n    const summary = {\r\n      totalConnections: 0,\r\n      totalDisconnections: 0,\r\n      totalRefreshes: 0,\r\n      totalFailures: 0,\r\n      platformStats: {\r\n        twitter: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        linkedin: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        facebook: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        instagram: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n      },\r\n      recentActivity: logs.slice(0, 10),\r\n    }\r\n\r\n    for (const log of logs) {\r\n      if (log.status === 'failed') {\r\n        summary.totalFailures++\r\n        ;(summary.platformStats as any)[(log as any).platform].failures++\r\n      }\r\n\r\n      if (log.action === 'platform_connected') {\r\n        summary.totalConnections++\r\n        ;(summary.platformStats as any)[(log as any).platform].connections++\r\n      } else if (log.action === 'platform_disconnected') {\r\n        summary.totalDisconnections++\r\n        ;(summary.platformStats as any)[(log as any).platform].disconnections++\r\n      } else if (log.action === 'token_refreshed') {\r\n        summary.totalRefreshes++\r\n        ;(summary.platformStats as any)[(log as any).platform].refreshes++\r\n      }\r\n    }\r\n\r\n    return summary\r\n  } catch (error) {\r\n    console.error('Error getting audit summary:', error)\r\n    return {\r\n      totalConnections: 0,\r\n      totalDisconnections: 0,\r\n      totalRefreshes: 0,\r\n      totalFailures: 0,\r\n      platformStats: {\r\n        twitter: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        linkedin: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        facebook: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        instagram: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n      },\r\n      recentActivity: [],\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up old audit logs (older than 90 days)\r\n */\r\nexport async function cleanupOldAuditLogs(): Promise<number> {\r\n  try {\r\n    const ninetyDaysAgo = new Date()\r\n    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90)\r\n\r\n    const { data, error } = await supabase\r\n      .from('credential_audit_log')\r\n      .delete()\r\n      .lt('created_at', ninetyDaysAgo.toISOString())\r\n      .select('id')\r\n\r\n    if (error) throw error\r\n\r\n    return data?.length || 0\r\n  } catch (error) {\r\n    console.error('Error cleaning up audit logs:', error)\r\n    return 0\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/services/database/credentialService.ts"],"sourcesContent":["/**\r\n * Server-side Credential Service\r\n * Single source of truth for credentials (database-backed only)\r\n * Proper encryption/decryption with workspace-specific keys\r\n * Token refresh handling\r\n */\r\n\r\nimport { supabase } from '@/lib/supabase'\r\nimport {\r\n  encryptCredentials,\r\n  decryptCredentials,\r\n  getOrCreateWorkspaceEncryptionKey,\r\n} from '@/lib/auth/encryptionManager'\r\nimport { logAuditEvent } from './auditLogService'\r\nimport type { Platform } from '@/types'\r\n\r\nexport class CredentialService {\r\n  /**\r\n   * Save platform credentials to database\r\n   * Encrypts using workspace-specific key\r\n   */\r\n  static async savePlatformCredentials(\r\n    platform: Platform,\r\n    credentials: any,\r\n    userId: string,\r\n    workspaceId: string,\r\n    options: { pageId?: string; pageName?: string } = {}\r\n  ): Promise<void> {\r\n    try {\r\n      // Get encryption key for this workspace\r\n      const encryptionKey = await getOrCreateWorkspaceEncryptionKey(workspaceId)\r\n\r\n      // Encrypt credentials\r\n      const encryptedData = await encryptCredentials(credentials, encryptionKey)\r\n\r\n      // Check if already exists\r\n      const { data: existing, error: checkError } = await supabase\r\n        .from('social_accounts')\r\n        .select('id')\r\n        .eq('workspace_id', workspaceId)\r\n        .eq('platform', platform)\r\n        .maybeSingle()\r\n\r\n      if (checkError) throw checkError\r\n\r\n      // Prepare common data\r\n      const commonData = {\r\n        credentials_encrypted: encryptedData,\r\n        is_connected: credentials.isConnected ?? true,\r\n        username: credentials.username || null,\r\n        expires_at: credentials.expiresAt || null,\r\n        last_refreshed_at: new Date().toISOString(),\r\n        refresh_token_encrypted: credentials.refreshToken\r\n          ? await encryptCredentials(\r\n              { token: credentials.refreshToken },\r\n              encryptionKey\r\n            )\r\n          : null,\r\n        page_id: options.pageId || null,\r\n        page_name: options.pageName || null,\r\n        connected_at: credentials.isConnected ? new Date().toISOString() : null,\r\n        refresh_error_count: 0,\r\n      }\r\n\r\n      if (existing) {\r\n        // Update existing\r\n        const { error: updateError } = await (supabase\r\n          .from('social_accounts') as any)\r\n          .update(commonData)\r\n          .eq('id', (existing as any).id)\r\n\r\n        if (updateError) throw updateError\r\n\r\n        // Log audit\r\n        await logAuditEvent({\r\n          workspaceId,\r\n          userId,\r\n          platform,\r\n          action: 'credentials_updated',\r\n          status: 'success',\r\n        })\r\n      } else {\r\n        // Insert new\r\n        const { error: insertError } = await (supabase.from('social_accounts') as any).insert({\r\n          workspace_id: workspaceId,\r\n          platform,\r\n          ...commonData,\r\n        })\r\n\r\n        if (insertError) throw insertError\r\n\r\n        await logAuditEvent({\r\n          workspaceId,\r\n          userId,\r\n          platform,\r\n          action: 'platform_connected',\r\n          status: 'success',\r\n        })\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving credentials:', error)\r\n\r\n      await logAuditEvent({\r\n        workspaceId,\r\n        userId,\r\n        platform,\r\n        action: 'credentials_save_failed',\r\n        status: 'failed',\r\n        errorMessage: error instanceof Error ? error.message : String(error),\r\n        errorCode: 'SAVE_ERROR',\r\n      }).catch(err => console.error('Failed to log error:', err))\r\n\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get credentials for a specific platform\r\n   */\r\n  static async getPlatformCredentials(\r\n    platform: Platform,\r\n    userId: string,\r\n    workspaceId: string\r\n  ): Promise<any | null> {\r\n    try {\r\n      const { data, error } = await (supabase\r\n        .from('social_accounts') as any)\r\n        .select('*')\r\n        .eq('workspace_id', workspaceId)\r\n        .eq('platform', platform)\r\n        .maybeSingle()\r\n\r\n      if (error || !data) return null\r\n\r\n      // Decrypt credentials\r\n      const encryptionKey = await getOrCreateWorkspaceEncryptionKey(workspaceId)\r\n      const credentials = await decryptCredentials((data as any).credentials_encrypted, encryptionKey)\r\n\r\n      // Decrypt refresh token if exists\r\n      let refreshToken = null\r\n      if ((data as any).refresh_token_encrypted) {\r\n        try {\r\n          const decryptedRefresh = await decryptCredentials(\r\n            (data as any).refresh_token_encrypted,\r\n            encryptionKey\r\n          )\r\n          refreshToken = decryptedRefresh.token\r\n        } catch (err) {\r\n          console.error('Failed to decrypt refresh token:', err)\r\n        }\r\n      }\r\n\r\n      return {\r\n        ...credentials,\r\n        refreshToken,\r\n        expiresAt: (data as any).expires_at,\r\n        pageId: (data as any).page_id,\r\n        pageName: (data as any).page_name,\r\n        isConnected: (data as any).is_connected,\r\n      }\r\n    } catch (error) {\r\n      console.error('Error getting credentials:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify and refresh token if needed\r\n   */\r\n  static async verifyAndRefreshToken(\r\n    platform: Platform,\r\n    userId: string,\r\n    workspaceId: string,\r\n    refreshFunction?: (credentials: any) => Promise<any>\r\n  ): Promise<any> {\r\n    try {\r\n      const credentials = await this.getPlatformCredentials(platform, userId, workspaceId)\r\n\r\n      if (!credentials) {\r\n        throw new Error(`No credentials found for ${platform}`)\r\n      }\r\n\r\n      // Check if token is expired\r\n      if (credentials.expiresAt) {\r\n        const expiresAt = new Date(credentials.expiresAt).getTime()\r\n        const now = Date.now()\r\n\r\n        if (now > expiresAt) {\r\n          // Token expired, try to refresh\r\n          if (refreshFunction && credentials.refreshToken) {\r\n            try {\r\n              const newCredentials = await refreshFunction(credentials)\r\n\r\n              // Save refreshed credentials\r\n              await this.savePlatformCredentials(\r\n                platform,\r\n                newCredentials,\r\n                userId,\r\n                workspaceId\r\n              )\r\n\r\n              await logAuditEvent({\r\n                workspaceId,\r\n                userId,\r\n                platform,\r\n                action: 'token_refreshed',\r\n                status: 'success',\r\n              })\r\n\r\n              return newCredentials\r\n            } catch (refreshError) {\r\n              await logAuditEvent({\r\n                workspaceId,\r\n                userId,\r\n                platform,\r\n                action: 'token_refresh_failed',\r\n                status: 'failed',\r\n                errorMessage:\r\n                  refreshError instanceof Error ? refreshError.message : String(refreshError),\r\n                errorCode: 'REFRESH_ERROR',\r\n              })\r\n\r\n              throw new Error(\r\n                `Token refresh failed: ${\r\n                  refreshError instanceof Error ? refreshError.message : String(refreshError)\r\n                }`\r\n              )\r\n            }\r\n          } else {\r\n            throw new Error('Token expired and no refresh token available')\r\n          }\r\n        }\r\n      }\r\n\r\n      return credentials\r\n    } catch (error) {\r\n      console.error('Token verification failed:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disconnect platform\r\n   */\r\n  static async disconnectPlatform(\r\n    platform: Platform,\r\n    userId: string,\r\n    workspaceId: string\r\n  ): Promise<void> {\r\n    try {\r\n      const { error } = await (supabase\r\n        .from('social_accounts') as any)\r\n        .update({\r\n          is_connected: false,\r\n          credentials_encrypted: null,\r\n          refresh_token_encrypted: null,\r\n          connected_at: null,\r\n        })\r\n        .eq('workspace_id', workspaceId)\r\n        .eq('platform', platform)\r\n\r\n      if (error) throw error\r\n\r\n      await logAuditEvent({\r\n        workspaceId,\r\n        userId,\r\n        platform,\r\n        action: 'platform_disconnected',\r\n        status: 'success',\r\n      })\r\n    } catch (error) {\r\n      console.error('Error disconnecting platform:', error)\r\n\r\n      await logAuditEvent({\r\n        workspaceId,\r\n        userId,\r\n        platform,\r\n        action: 'disconnect_failed',\r\n        status: 'failed',\r\n        errorMessage: error instanceof Error ? error.message : String(error),\r\n        errorCode: 'DISCONNECT_ERROR',\r\n      }).catch(err => console.error('Failed to log error:', err))\r\n\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get connection status for all platforms\r\n   */\r\n  static async getConnectionStatus(\r\n    workspaceId: string\r\n  ): Promise<Record<Platform, any>> {\r\n    try {\r\n      const { data, error } = await (supabase\r\n        .from('social_accounts') as any)\r\n        .select('platform, is_connected, username, page_name, expires_at')\r\n        .eq('workspace_id', workspaceId)\r\n\r\n      if (error) throw error\r\n\r\n      const status: Record<string, any> = {\r\n        twitter: { isConnected: false },\r\n        linkedin: { isConnected: false },\r\n        facebook: { isConnected: false },\r\n        instagram: { isConnected: false },\r\n      }\r\n\r\n      const now = Date.now()\r\n      const oneDayMs = 1000 * 60 * 60 * 24\r\n\r\n      for (const account of data || []) {\r\n        const expiresAt: number | null = ((account as any).expires_at\r\n          ? new Date((account as any).expires_at).getTime()\r\n          : null) as number | null\r\n\r\n        (status as any)[(account as any).platform] = {\r\n          isConnected: (account as any).is_connected,\r\n          username: (account as any).username || (account as any).page_name,\r\n          expiresAt: (account as any).expires_at,\r\n          isExpiringSoon:\r\n            expiresAt && expiresAt - now < oneDayMs && expiresAt > now,\r\n          isExpired: expiresAt && expiresAt <= now,\r\n        }\r\n      }\r\n\r\n      return status\r\n    } catch (error) {\r\n      console.error('Error getting connection status:', error)\r\n      return {\r\n        twitter: { isConnected: false },\r\n        linkedin: { isConnected: false },\r\n        facebook: { isConnected: false },\r\n        instagram: { isConnected: false },\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete platform credentials completely\r\n   */\r\n  static async deletePlatformCredentials(\r\n    platform: Platform,\r\n    workspaceId: string\r\n  ): Promise<void> {\r\n    try {\r\n      const { error } = await (supabase\r\n        .from('social_accounts') as any)\r\n        .delete()\r\n        .eq('workspace_id', workspaceId)\r\n        .eq('platform', platform)\r\n\r\n      if (error) throw error\r\n    } catch (error) {\r\n      console.error('Error deleting credentials:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all connection statuses\r\n   */\r\n  static async getAllCredentialsStatus(\r\n    workspaceId: string\r\n  ): Promise<Array<{ platform: Platform; isConnected: boolean; username?: string }>> {\r\n    try {\r\n      const { data, error } = await (supabase\r\n        .from('social_accounts') as any)\r\n        .select('platform, is_connected, username, page_name')\r\n        .eq('workspace_id', workspaceId)\r\n\r\n      if (error) throw error\r\n\r\n      return (data || []).map((account: any) => ({\r\n        platform: account.platform as Platform,\r\n        isConnected: account.is_connected,\r\n        username: account.username || account.page_name,\r\n      }))\r\n    } catch (error) {\r\n      console.error('Error getting all credentials status:', error)\r\n      return []\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 755, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/app/api/credentials/status/route.ts"],"sourcesContent":["/**\r\n * Credentials Status Endpoint\r\n * GET /api/credentials/status\r\n *\r\n * Returns connection status for all platforms\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server'\r\nimport { createServerClient } from '@/lib/supabase/server'\r\nimport { CredentialService } from '@/services/database/credentialService'\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // ✅ Authenticate user\r\n    const supabase = await createServerClient()\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // ✅ Get workspace\r\n    const { data: userRow, error: userError } = await supabase\r\n      .from('users')\r\n      .select('workspace_id')\r\n      .eq('id', user.id)\r\n      .maybeSingle()\r\n\r\n    if (userError || !userRow) {\r\n      return NextResponse.json(\r\n        { error: 'Workspace not found' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // ✅ Get connection status\r\n    const status = await CredentialService.getConnectionStatus((userRow as any).workspace_id)\r\n\r\n    return NextResponse.json(status)\r\n  } catch (error) {\r\n    console.error('Status check error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to check status' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;AAED;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,sBAAsB;QACtB,MAAM,WAAW,MAAM,IAAA,wJAAkB;QACzC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEtD,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAC/C,IAAI,CAAC,SACL,MAAM,CAAC,gBACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,WAAW;QAEd,IAAI,aAAa,CAAC,SAAS;YACzB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,0BAA0B;QAC1B,MAAM,SAAS,MAAM,uKAAiB,CAAC,mBAAmB,CAAC,AAAC,QAAgB,YAAY;QAExF,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}