{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/server.ts"],"sourcesContent":["/**\r\n * Supabase Server Client\r\n * Use this client in server components, API routes, and server actions\r\n */\r\n\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport type { Database } from './types'\r\n\r\nexport async function createClient() {\n  const cookieStore = await cookies()\n\r\n  return createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value\r\n        },\r\n        set(name: string, value: string, options: CookieOptions) {\r\n          try {\r\n            cookieStore.set({ name, value, ...options })\r\n          } catch (error) {\r\n            // Handle cookie errors (happens in Server Components)\r\n          }\r\n        },\r\n        remove(name: string, options: CookieOptions) {\r\n          try {\r\n            cookieStore.set({ name, value: '', ...options })\r\n          } catch (error) {\r\n            // Handle cookie errors\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\n}\n\n// Alias to match existing imports in API routes\nexport { createClient as createServerClient }\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAED;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACrD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAO,OAAO;gBACd,sDAAsD;gBACxD;YACF;YACA,QAAO,IAAY,EAAE,OAAsB;gBACzC,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;oBAAC;gBAChD,EAAE,OAAO,OAAO;gBACd,uBAAuB;gBACzB;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/index.ts/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const createBrowserClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call createBrowserClient() from the server but createBrowserClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts <module evaluation>\",\n    \"createBrowserClient\",\n);\nexport const supabase = registerClientReference(\n    function() { throw new Error(\"Attempted to call supabase() from the server but supabase is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts <module evaluation>\",\n    \"supabase\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,0QAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,2DACA;AAEG,MAAM,WAAW,IAAA,0QAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,2DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/index.ts/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const createBrowserClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call createBrowserClient() from the server but createBrowserClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts\",\n    \"createBrowserClient\",\n);\nexport const supabase = registerClientReference(\n    function() { throw new Error(\"Attempted to call supabase() from the server but supabase is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/lib/supabase/index.ts\",\n    \"supabase\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,0QAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,uCACA;AAEG,MAAM,WAAW,IAAA,0QAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,uCACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/services/database/auditLogService.ts"],"sourcesContent":["/**\r\n * Audit Log Service\r\n * Logs all credential-related events for compliance and debugging\r\n */\r\n\r\nimport { supabase } from '@/lib/supabase'\r\nimport type { Platform } from '@/types'\r\n\r\nexport interface AuditEventParams {\r\n  workspaceId: string\r\n  userId: string\r\n  platform: Platform\r\n  action: string\r\n  status: 'success' | 'failed' | 'partial'\r\n  errorMessage?: string\r\n  errorCode?: string\r\n  ipAddress?: string\r\n  userAgent?: string\r\n  requestPath?: string\r\n  metadata?: any\r\n}\r\n\r\n/**\r\n * Log an audit event\r\n */\r\nexport async function logAuditEvent({\r\n  workspaceId,\r\n  userId,\r\n  platform,\r\n  action,\r\n  status,\r\n  errorMessage,\r\n  errorCode,\r\n  ipAddress,\r\n  userAgent,\r\n  requestPath,\r\n  metadata,\r\n}: AuditEventParams): Promise<void> {\r\n  try {\r\n    const { error } = await supabase.from('credential_audit_log').insert({\r\n      workspace_id: workspaceId,\r\n      user_id: userId,\r\n      platform,\r\n      action,\r\n      status,\r\n      error_message: errorMessage || null,\r\n      error_code: errorCode || null,\r\n      ip_address: ipAddress || null,\r\n      user_agent: userAgent || null,\r\n      request_path: requestPath || null,\r\n      metadata: metadata || null,\r\n    } as any)\r\n\r\n    if (error) {\r\n      console.error('Failed to insert audit log:', error)\r\n    }\r\n  } catch (error) {\r\n    console.error('Audit logging error:', error)\r\n    // Don't throw - logging failures shouldn't break the app\r\n  }\r\n}\r\n\r\n/**\r\n * Get audit logs for a workspace\r\n */\r\nexport async function getAuditLogs(\r\n  workspaceId: string,\r\n  filters?: {\r\n    platform?: Platform\r\n    action?: string\r\n    status?: string\r\n    limit?: number\r\n    offset?: number\r\n    startDate?: Date\r\n    endDate?: Date\r\n  }\r\n): Promise<any[]> {\r\n  try {\r\n    let query = supabase\r\n      .from('credential_audit_log')\r\n      .select('*')\r\n      .eq('workspace_id', workspaceId)\r\n      .order('created_at', { ascending: false })\r\n\r\n    if (filters?.platform) {\r\n      query = query.eq('platform', filters.platform)\r\n    }\r\n\r\n    if (filters?.action) {\r\n      query = query.eq('action', filters.action)\r\n    }\r\n\r\n    if (filters?.status) {\r\n      query = query.eq('status', filters.status)\r\n    }\r\n\r\n    if (filters?.startDate) {\r\n      query = query.gte('created_at', filters.startDate.toISOString())\r\n    }\r\n\r\n    if (filters?.endDate) {\r\n      query = query.lte('created_at', filters.endDate.toISOString())\r\n    }\r\n\r\n    const limit = Math.min(filters?.limit || 100, 1000) // Cap at 1000\r\n    const offset = filters?.offset || 0\r\n\r\n    query = query.range(offset, offset + limit - 1)\r\n\r\n    const { data, error } = await query\r\n\r\n    if (error) throw error\r\n    return data || []\r\n  } catch (error) {\r\n    console.error('Error fetching audit logs:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get audit logs for a specific user\r\n */\r\nexport async function getUserAuditLogs(\r\n  workspaceId: string,\r\n  userId: string,\r\n  options?: {\r\n    limit?: number\r\n    offset?: number\r\n  }\r\n): Promise<any[]> {\r\n  try {\r\n    let query = supabase\r\n      .from('credential_audit_log')\r\n      .select('*')\r\n      .eq('workspace_id', workspaceId)\r\n      .eq('user_id', userId)\r\n      .order('created_at', { ascending: false })\r\n\r\n    const limit = Math.min(options?.limit || 50, 500)\r\n    const offset = options?.offset || 0\r\n\r\n    query = query.range(offset, offset + limit - 1)\r\n\r\n    const { data, error } = await query\r\n\r\n    if (error) throw error\r\n    return data || []\r\n  } catch (error) {\r\n    console.error('Error fetching user audit logs:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get summary of credential activities\r\n */\r\nexport async function getAuditSummary(\r\n  workspaceId: string,\r\n  days: number = 7\r\n): Promise<{\r\n  totalConnections: number\r\n  totalDisconnections: number\r\n  totalRefreshes: number\r\n  totalFailures: number\r\n  platformStats: Record<string, any>\r\n  recentActivity: any[]\r\n}> {\r\n  try {\r\n    const startDate = new Date()\r\n    startDate.setDate(startDate.getDate() - days)\r\n\r\n    const logs = await getAuditLogs(workspaceId, {\r\n      startDate,\r\n      limit: 1000,\r\n    })\r\n\r\n    const summary = {\r\n      totalConnections: 0,\r\n      totalDisconnections: 0,\r\n      totalRefreshes: 0,\r\n      totalFailures: 0,\r\n      platformStats: {\r\n        twitter: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        linkedin: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        facebook: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        instagram: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n      },\r\n      recentActivity: logs.slice(0, 10),\r\n    }\r\n\r\n    for (const log of logs) {\r\n      if (log.status === 'failed') {\r\n        summary.totalFailures++\r\n        ;(summary.platformStats as any)[(log as any).platform].failures++\r\n      }\r\n\r\n      if (log.action === 'platform_connected') {\r\n        summary.totalConnections++\r\n        ;(summary.platformStats as any)[(log as any).platform].connections++\r\n      } else if (log.action === 'platform_disconnected') {\r\n        summary.totalDisconnections++\r\n        ;(summary.platformStats as any)[(log as any).platform].disconnections++\r\n      } else if (log.action === 'token_refreshed') {\r\n        summary.totalRefreshes++\r\n        ;(summary.platformStats as any)[(log as any).platform].refreshes++\r\n      }\r\n    }\r\n\r\n    return summary\r\n  } catch (error) {\r\n    console.error('Error getting audit summary:', error)\r\n    return {\r\n      totalConnections: 0,\r\n      totalDisconnections: 0,\r\n      totalRefreshes: 0,\r\n      totalFailures: 0,\r\n      platformStats: {\r\n        twitter: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        linkedin: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        facebook: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n        instagram: { connections: 0, disconnections: 0, refreshes: 0, failures: 0 },\r\n      },\r\n      recentActivity: [],\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up old audit logs (older than 90 days)\r\n */\r\nexport async function cleanupOldAuditLogs(): Promise<number> {\r\n  try {\r\n    const ninetyDaysAgo = new Date()\r\n    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90)\r\n\r\n    const { data, error } = await supabase\r\n      .from('credential_audit_log')\r\n      .delete()\r\n      .lt('created_at', ninetyDaysAgo.toISOString())\r\n      .select('id')\r\n\r\n    if (error) throw error\r\n\r\n    return data?.length || 0\r\n  } catch (error) {\r\n    console.error('Error cleaning up audit logs:', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n// ============================================\r\n// WORKSPACE-SPECIFIC AUDIT LOGGING\r\n// ============================================\r\n\r\nexport type WorkspaceAuditAction =\r\n  | 'member_invited'        // When someone sends an invite\r\n  | 'member_joined'         // When someone accepts invite\r\n  | 'member_removed'        // When admin removes a member\r\n  | 'member_role_changed'   // When admin changes member's role\r\n  | 'workspace_updated'     // When workspace settings change\r\n  | 'invite_revoked'        // When admin cancels an invite\r\n\r\nexport interface WorkspaceAuditLogParams {\r\n  workspaceId: string\r\n  userId: string\r\n  action: WorkspaceAuditAction\r\n  entityType: string\r\n  entityId: string\r\n  details: Record<string, any>\r\n}\r\n\r\n/**\r\n * Log workspace-related actions for audit trail\r\n * Used for: member invitations, role changes, removals, etc.\r\n *\r\n * @param params - Audit log parameters\r\n * @throws Errors are logged but not thrown to prevent breaking operations\r\n */\r\nexport async function logWorkspaceAction({\r\n  workspaceId,\r\n  userId,\r\n  action,\r\n  entityType,\r\n  entityId,\r\n  details,\r\n}: WorkspaceAuditLogParams): Promise<void> {\r\n  try {\r\n    const { error } = await (supabase.from('audit_logs') as any).insert({\r\n      workspace_id: workspaceId,\r\n      user_id: userId,\r\n      action,\r\n      entity_type: entityType,\r\n      entity_id: entityId,\r\n      details,\r\n      created_at: new Date().toISOString(),\r\n    })\r\n\r\n    if (error) {\r\n      console.error(`Failed to log workspace action \"${action}\":`, error)\r\n    }\r\n  } catch (error) {\r\n    console.error('Workspace audit logging error:', error)\r\n    // Don't throw - logging failures shouldn't break the app\r\n  }\r\n}\r\n\r\n/**\r\n * Get workspace activity log with filters\r\n *\r\n * @param workspaceId - Workspace to get activity for\r\n * @param filters - Optional filters for activity type, user, date range\r\n * @returns Paginated activity logs with total count\r\n */\r\nexport async function getWorkspaceActivityLog(\r\n  workspaceId: string,\r\n  filters?: {\r\n    userId?: string\r\n    action?: WorkspaceAuditAction\r\n    startDate?: Date\r\n    endDate?: Date\r\n    limit?: number\r\n    offset?: number\r\n  }\r\n): Promise<{\r\n  data: any[]\r\n  total: number\r\n  limit: number\r\n  offset: number\r\n  hasMore: boolean\r\n}> {\r\n  try {\r\n    // Build the query\r\n    let query = supabase\r\n      .from('audit_logs')\r\n      .select(\r\n        `\r\n        id,\r\n        workspace_id,\r\n        user_id,\r\n        action,\r\n        entity_type,\r\n        entity_id,\r\n        details,\r\n        created_at,\r\n        users:user_id (\r\n          email,\r\n          full_name\r\n        )\r\n      `,\r\n        { count: 'exact' }\r\n      )\r\n      .eq('workspace_id', workspaceId)\r\n      .order('created_at', { ascending: false })\r\n\r\n    // Apply filters\r\n    if (filters?.userId) {\r\n      query = query.eq('user_id', filters.userId)\r\n    }\r\n\r\n    if (filters?.action) {\r\n      query = query.eq('action', filters.action)\r\n    }\r\n\r\n    if (filters?.startDate) {\r\n      query = query.gte('created_at', filters.startDate.toISOString())\r\n    }\r\n\r\n    if (filters?.endDate) {\r\n      query = query.lte('created_at', filters.endDate.toISOString())\r\n    }\r\n\r\n    // Pagination\r\n    const limit = Math.min(filters?.limit || 50, 500) // Cap at 500\r\n    const offset = filters?.offset || 0\r\n    query = query.range(offset, offset + limit - 1)\r\n\r\n    const { data, error, count } = await query\r\n\r\n    if (error) {\r\n      console.error('Error fetching workspace activity log:', error)\r\n      throw error\r\n    }\r\n\r\n    return {\r\n      data: data || [],\r\n      total: count || 0,\r\n      limit,\r\n      offset,\r\n      hasMore: (count || 0) > offset + limit,\r\n    }\r\n  } catch (error) {\r\n    console.error('Error getting workspace activity log:', error)\r\n    return {\r\n      data: [],\r\n      total: 0,\r\n      limit: filters?.limit || 50,\r\n      offset: filters?.offset || 0,\r\n      hasMore: false,\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;AAED;;AAoBO,eAAe,cAAc,EAClC,WAAW,EACX,MAAM,EACN,QAAQ,EACR,MAAM,EACN,MAAM,EACN,YAAY,EACZ,SAAS,EACT,SAAS,EACT,SAAS,EACT,WAAW,EACX,QAAQ,EACS;IACjB,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,6IAAQ,CAAC,IAAI,CAAC,wBAAwB,MAAM,CAAC;YACnE,cAAc;YACd,SAAS;YACT;YACA;YACA;YACA,eAAe,gBAAgB;YAC/B,YAAY,aAAa;YACzB,YAAY,aAAa;YACzB,YAAY,aAAa;YACzB,cAAc,eAAe;YAC7B,UAAU,YAAY;QACxB;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,+BAA+B;QAC/C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;IACtC,yDAAyD;IAC3D;AACF;AAKO,eAAe,aACpB,WAAmB,EACnB,OAQC;IAED,IAAI;QACF,IAAI,QAAQ,6IAAQ,CACjB,IAAI,CAAC,wBACL,MAAM,CAAC,KACP,EAAE,CAAC,gBAAgB,aACnB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,SAAS,UAAU;YACrB,QAAQ,MAAM,EAAE,CAAC,YAAY,QAAQ,QAAQ;QAC/C;QAEA,IAAI,SAAS,QAAQ;YACnB,QAAQ,MAAM,EAAE,CAAC,UAAU,QAAQ,MAAM;QAC3C;QAEA,IAAI,SAAS,QAAQ;YACnB,QAAQ,MAAM,EAAE,CAAC,UAAU,QAAQ,MAAM;QAC3C;QAEA,IAAI,SAAS,WAAW;YACtB,QAAQ,MAAM,GAAG,CAAC,cAAc,QAAQ,SAAS,CAAC,WAAW;QAC/D;QAEA,IAAI,SAAS,SAAS;YACpB,QAAQ,MAAM,GAAG,CAAC,cAAc,QAAQ,OAAO,CAAC,WAAW;QAC7D;QAEA,MAAM,QAAQ,KAAK,GAAG,CAAC,SAAS,SAAS,KAAK,MAAM,cAAc;;QAClE,MAAM,SAAS,SAAS,UAAU;QAElC,QAAQ,MAAM,KAAK,CAAC,QAAQ,SAAS,QAAQ;QAE7C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAE9B,IAAI,OAAO,MAAM;QACjB,OAAO,QAAQ,EAAE;IACnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACX;AACF;AAKO,eAAe,iBACpB,WAAmB,EACnB,MAAc,EACd,OAGC;IAED,IAAI;QACF,IAAI,QAAQ,6IAAQ,CACjB,IAAI,CAAC,wBACL,MAAM,CAAC,KACP,EAAE,CAAC,gBAAgB,aACnB,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,MAAM,QAAQ,KAAK,GAAG,CAAC,SAAS,SAAS,IAAI;QAC7C,MAAM,SAAS,SAAS,UAAU;QAElC,QAAQ,MAAM,KAAK,CAAC,QAAQ,SAAS,QAAQ;QAE7C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAE9B,IAAI,OAAO,MAAM;QACjB,OAAO,QAAQ,EAAE;IACnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,EAAE;IACX;AACF;AAKO,eAAe,gBACpB,WAAmB,EACnB,OAAe,CAAC;IAShB,IAAI;QACF,MAAM,YAAY,IAAI;QACtB,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;QAExC,MAAM,OAAO,MAAM,aAAa,aAAa;YAC3C;YACA,OAAO;QACT;QAEA,MAAM,UAAU;YACd,kBAAkB;YAClB,qBAAqB;YACrB,gBAAgB;YAChB,eAAe;YACf,eAAe;gBACb,SAAS;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACxE,UAAU;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACzE,UAAU;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACzE,WAAW;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;YAC5E;YACA,gBAAgB,KAAK,KAAK,CAAC,GAAG;QAChC;QAEA,KAAK,MAAM,OAAO,KAAM;YACtB,IAAI,IAAI,MAAM,KAAK,UAAU;gBAC3B,QAAQ,aAAa;gBACnB,QAAQ,aAAa,AAAQ,CAAC,AAAC,IAAY,QAAQ,CAAC,CAAC,QAAQ;YACjE;YAEA,IAAI,IAAI,MAAM,KAAK,sBAAsB;gBACvC,QAAQ,gBAAgB;gBACtB,QAAQ,aAAa,AAAQ,CAAC,AAAC,IAAY,QAAQ,CAAC,CAAC,WAAW;YACpE,OAAO,IAAI,IAAI,MAAM,KAAK,yBAAyB;gBACjD,QAAQ,mBAAmB;gBACzB,QAAQ,aAAa,AAAQ,CAAC,AAAC,IAAY,QAAQ,CAAC,CAAC,cAAc;YACvE,OAAO,IAAI,IAAI,MAAM,KAAK,mBAAmB;gBAC3C,QAAQ,cAAc;gBACpB,QAAQ,aAAa,AAAQ,CAAC,AAAC,IAAY,QAAQ,CAAC,CAAC,SAAS;YAClE;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YACL,kBAAkB;YAClB,qBAAqB;YACrB,gBAAgB;YAChB,eAAe;YACf,eAAe;gBACb,SAAS;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACxE,UAAU;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACzE,UAAU;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;gBACzE,WAAW;oBAAE,aAAa;oBAAG,gBAAgB;oBAAG,WAAW;oBAAG,UAAU;gBAAE;YAC5E;YACA,gBAAgB,EAAE;QACpB;IACF;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,gBAAgB,IAAI;QAC1B,cAAc,OAAO,CAAC,cAAc,OAAO,KAAK;QAEhD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,6IAAQ,CACnC,IAAI,CAAC,wBACL,MAAM,GACN,EAAE,CAAC,cAAc,cAAc,WAAW,IAC1C,MAAM,CAAC;QAEV,IAAI,OAAO,MAAM;QAEjB,OAAO,MAAM,UAAU;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;IACT;AACF;AA8BO,eAAe,mBAAmB,EACvC,WAAW,EACX,MAAM,EACN,MAAM,EACN,UAAU,EACV,QAAQ,EACR,OAAO,EACiB;IACxB,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,AAAC,6IAAQ,CAAC,IAAI,CAAC,cAAsB,MAAM,CAAC;YAClE,cAAc;YACd,SAAS;YACT;YACA,aAAa;YACb,WAAW;YACX;YACA,YAAY,IAAI,OAAO,WAAW;QACpC;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,OAAO,EAAE,CAAC,EAAE;QAC/D;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;IAChD,yDAAyD;IAC3D;AACF;AASO,eAAe,wBACpB,WAAmB,EACnB,OAOC;IAQD,IAAI;QACF,kBAAkB;QAClB,IAAI,QAAQ,6IAAQ,CACjB,IAAI,CAAC,cACL,MAAM,CACL,CAAC;;;;;;;;;;;;;MAaH,CAAC,EACC;YAAE,OAAO;QAAQ,GAElB,EAAE,CAAC,gBAAgB,aACnB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,gBAAgB;QAChB,IAAI,SAAS,QAAQ;YACnB,QAAQ,MAAM,EAAE,CAAC,WAAW,QAAQ,MAAM;QAC5C;QAEA,IAAI,SAAS,QAAQ;YACnB,QAAQ,MAAM,EAAE,CAAC,UAAU,QAAQ,MAAM;QAC3C;QAEA,IAAI,SAAS,WAAW;YACtB,QAAQ,MAAM,GAAG,CAAC,cAAc,QAAQ,SAAS,CAAC,WAAW;QAC/D;QAEA,IAAI,SAAS,SAAS;YACpB,QAAQ,MAAM,GAAG,CAAC,cAAc,QAAQ,OAAO,CAAC,WAAW;QAC7D;QAEA,aAAa;QACb,MAAM,QAAQ,KAAK,GAAG,CAAC,SAAS,SAAS,IAAI,KAAK,aAAa;;QAC/D,MAAM,SAAS,SAAS,UAAU;QAClC,QAAQ,MAAM,KAAK,CAAC,QAAQ,SAAS,QAAQ;QAE7C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM;QAErC,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0CAA0C;YACxD,MAAM;QACR;QAEA,OAAO;YACL,MAAM,QAAQ,EAAE;YAChB,OAAO,SAAS;YAChB;YACA;YACA,SAAS,CAAC,SAAS,CAAC,IAAI,SAAS;QACnC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO;YACL,MAAM,EAAE;YACR,OAAO;YACP,OAAO,SAAS,SAAS;YACzB,QAAQ,SAAS,UAAU;YAC3B,SAAS;QACX;IACF;AACF","debugId":null}},
    {"offset": {"line": 463, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/app/api/workspace/activity/route.ts"],"sourcesContent":["/**\r\n * API Route: /api/workspace/activity\r\n * Methods: GET\r\n *\r\n * GET: Get activity/audit log for the workspace with filters\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server'\r\nimport { createServerClient } from '@/lib/supabase/server'\r\nimport { getWorkspaceActivityLog } from '@/services/database/auditLogService'\r\n\r\n/**\r\n * GET /api/workspace/activity\r\n * Get activity log for the workspace with optional filters\r\n * Requires: Admin role (to view activity)\r\n *\r\n * Query params (all optional):\r\n *   - userId: Filter by specific user\r\n *   - action: Filter by action type\r\n *   - startDate: ISO date string for start of range\r\n *   - endDate: ISO date string for end of range\r\n *   - limit: Number of results (default 50, max 500)\r\n *   - offset: Starting position (default 0)\r\n *\r\n * Response: { data: ActivityLogEntry[], total: number, limit: number, offset: number, hasMore: boolean }\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const supabase = await createServerClient()\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n\r\n    if (authError || !user) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // Get user's workspace and role\r\n    const { data: userData, error: userError } = await supabase\r\n      .from('users')\r\n      .select('workspace_id, role')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (userError || !userData || !('workspace_id' in userData)) {\r\n      return NextResponse.json(\r\n        { error: 'User profile not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    // Only admins can view activity logs\r\n    if ((userData as any).role !== 'admin') {\r\n      return NextResponse.json(\r\n        { error: 'Only admins can view activity logs' },\r\n        { status: 403 }\r\n      )\r\n    }\r\n\r\n    // Parse query parameters\r\n    const { searchParams } = new URL(request.url)\r\n\r\n    const userId = searchParams.get('userId') || undefined\r\n    const action = searchParams.get('action') || undefined\r\n    const startDate = searchParams.get('startDate')\r\n      ? new Date(searchParams.get('startDate')!)\r\n      : undefined\r\n    const endDate = searchParams.get('endDate')\r\n      ? new Date(searchParams.get('endDate')!)\r\n      : undefined\r\n\r\n    let limit = parseInt(searchParams.get('limit') || '50')\r\n    let offset = parseInt(searchParams.get('offset') || '0')\r\n\r\n    // Validate pagination parameters\r\n    if (isNaN(limit) || limit < 1) limit = 50\r\n    if (isNaN(offset) || offset < 0) offset = 0\r\n    if (limit > 500) limit = 500 // Cap at 500\r\n\r\n    // Validate date range\r\n    if (startDate && isNaN(startDate.getTime())) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid startDate format' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (endDate && isNaN(endDate.getTime())) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid endDate format' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Get activity log\r\n    const result = await getWorkspaceActivityLog((userData as any).workspace_id, {\r\n      userId,\r\n      action: action as any,\r\n      startDate,\r\n      endDate,\r\n      limit,\r\n      offset,\r\n    })\r\n\r\n    // Format activities for response\r\n    const activities = result.data.map((log: any) => ({\r\n      id: log.id,\r\n      workspace_id: log.workspace_id,\r\n      user_id: log.user_id,\r\n      user_email: log.users?.email || 'Unknown User',\r\n      user_name: log.users?.full_name || null,\r\n      action: log.action,\r\n      entity_type: log.entity_type,\r\n      entity_id: log.entity_id,\r\n      details: log.details,\r\n      created_at: log.created_at,\r\n    }))\r\n\r\n    return NextResponse.json({\r\n      data: activities,\r\n      total: result.total,\r\n      limit: result.limit,\r\n      offset: result.offset,\r\n      hasMore: result.hasMore,\r\n    })\r\n  } catch (error) {\r\n    console.error('Error in GET /api/workspace/activity:', error)\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}