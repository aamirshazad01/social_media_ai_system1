{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/client.ts"],"sourcesContent":["/**\r\n * Supabase Browser Client\r\n * Use this client in client-side components (components with \"use client\")\r\n */\r\n\r\nimport { createBrowserClient } from '@supabase/ssr'\r\nimport type { Database } from './types'\r\n\r\nexport function createClient() {\r\n  return createBrowserClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n  )\r\n}\r\n\r\n// Singleton instance for convenience\r\nexport const supabase = createClient()\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAED;AAAA;;AAGO,SAAS;IACd,OAAO,IAAA,iMAAmB;AAI5B;AAGO,MAAM,WAAW","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/lib/supabase/index.ts"],"sourcesContent":["/**\n * Supabase Client Exports (Client-only)\n * Import from here only in client components/services.\n * Server utilities should import from `@/lib/supabase/server` directly.\n */\n\"use client\"\n\nexport { createClient as createBrowserClient, supabase } from './client'\nexport type { Database } from './types'\n"],"names":[],"mappings":"AAAA;;;;CAIC;AAGD;AAFA","debugId":null}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aamir/social_media_os/src/contexts/AuthContext.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { User, Session } from '@supabase/supabase-js'\r\nimport { supabase } from '@/lib/supabase'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface AuthContextType {\r\n  user: User | null\r\n  session: Session | null\r\n  loading: boolean\r\n  workspaceId: string | null\r\n  userRole: 'admin' | 'editor' | 'viewer' | null\r\n  signUp: (email: string, password: string, fullName: string) => Promise<{ error: Error | null }>\r\n  signIn: (email: string, password: string) => Promise<{ error: Error | null }>\r\n  signOut: () => Promise<void>\r\n  refreshSession: () => Promise<void>\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [session, setSession] = useState<Session | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [workspaceId, setWorkspaceId] = useState<string | null>(null)\r\n  const [userRole, setUserRole] = useState<'admin' | 'editor' | 'viewer' | null>(null)\r\n\r\n  // Fetch user profile data (workspace_id and role)\r\n  const fetchUserProfile = async (userId: string) => {\r\n  try {\r\n    // Try RPC first to avoid users RLS recursion\r\n    const { data: rpcData, error: rpcError } = await supabase.rpc('get_my_profile')\r\n    if (!rpcError && rpcData) {\r\n      const d: any = Array.isArray(rpcData) ? rpcData[0] : rpcData\r\n      if (d) {\r\n        setWorkspaceId(d.workspace_id as string)\r\n        setUserRole(d.role as 'admin' | 'editor' | 'viewer')\r\n        return\r\n      }\r\n    }\r\n\r\n    // Fallback: direct select (requires non-recursive users RLS policy)\r\n    const { data, error } = await supabase\r\n      .from('users')\r\n      .select('workspace_id, role')\r\n      .eq('id', userId)\r\n      .maybeSingle()\r\n\r\n    if (error) throw error\r\n\r\n    if (!data) {\r\n      setWorkspaceId(null)\r\n      setUserRole(null)\r\n      return\r\n    }\r\n\r\n    setWorkspaceId((data as any).workspace_id as string)\r\n    setUserRole((data as any).role as 'admin' | 'editor' | 'viewer')\r\n  } catch (error) {\r\n    const e = error as any\r\n    console.error(\r\n      'Error fetching user profile:',\r\n      (e && (e.message || e.code || e.status || e.details)) ?? (typeof e === 'string' ? e : JSON.stringify(e))\r\n    )\r\n    setWorkspaceId(null)\r\n    setUserRole(null)\r\n  }\r\n}\r\n// Initialize session\r\n  useEffect(() => {\r\n    const initializeAuth = async () => {\r\n      try {\r\n        // Add a timeout to prevent indefinite loading\r\n        const timeoutPromise = new Promise((_, reject) =>\r\n          setTimeout(() => reject(new Error('Auth initialization timeout')), 5000)\r\n        )\r\n\r\n        // Get initial session with timeout\r\n        const sessionPromise = supabase.auth.getSession()\r\n        const { data: { session: initialSession } } = await Promise.race([\r\n          sessionPromise,\r\n          timeoutPromise\r\n        ]) as any\r\n\r\n        setSession(initialSession)\r\n        setUser(initialSession?.user ?? null)\r\n\r\n        if (initialSession?.user) {\r\n          await fetchUserProfile(initialSession.user.id)\r\n        }\r\n      } catch (error) {\r\n        console.error('Error initializing auth:', error)\r\n        // Set loading to false even on error to prevent stuck loading state\r\n        setLoading(false)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    initializeAuth()\r\n\r\n    // Listen for auth changes\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, currentSession) => {\r\n      console.log('Auth state changed:', event)\r\n\r\n      setSession(currentSession)\r\n      setUser(currentSession?.user ?? null)\r\n\r\n      if (currentSession?.user) {\r\n        await fetchUserProfile(currentSession.user.id)\r\n      } else {\r\n        setWorkspaceId(null)\r\n        setUserRole(null)\r\n      }\r\n\r\n      setLoading(false)\r\n    })\r\n\r\n    return () => {\r\n      subscription.unsubscribe()\r\n    }\r\n  }, [])\r\n\r\n  // Sign up new user\r\n  const signUp = async (email: string, password: string, fullName: string) => {\r\n    try {\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          data: {\r\n            full_name: fullName,\r\n          },\r\n        },\r\n      })\r\n\r\n      if (error) throw error\r\n\r\n      // The trigger function will automatically create workspace and user profile\r\n      return { error: null }\r\n    } catch (error) {\r\n      console.error('Sign up error:', error)\r\n      return { error: error as Error }\r\n    }\r\n  }\r\n\r\n  // Sign in existing user\r\n  const signIn = async (email: string, password: string) => {\r\n    try {\r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password,\r\n      })\r\n\r\n      if (error) throw error\r\n\r\n      return { error: null }\r\n    } catch (error) {\r\n      console.error('Sign in error:', error)\r\n      return { error: error as Error }\r\n    }\r\n  }\r\n\r\n  // Sign out\r\n  const signOut = async () => {\r\n    try {\r\n      await supabase.auth.signOut()\r\n      setWorkspaceId(null)\r\n      setUserRole(null)\r\n    } catch (error) {\r\n      console.error('Sign out error:', error)\r\n    }\r\n  }\r\n\r\n  // Refresh session\r\n  const refreshSession = async () => {\r\n    try {\r\n      const { data: { session: refreshedSession } } = await supabase.auth.getSession()\r\n      setSession(refreshedSession)\r\n      setUser(refreshedSession?.user ?? null)\r\n\r\n      if (refreshedSession?.user) {\r\n        await fetchUserProfile(refreshedSession.user.id)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error refreshing session:', error)\r\n    }\r\n  }\r\n\r\n  const value = {\r\n    user,\r\n    session,\r\n    loading,\r\n    workspaceId,\r\n    userRole,\r\n    signUp,\r\n    signIn,\r\n    signOut,\r\n    refreshSession,\r\n  }\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext)\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider')\r\n  }\r\n  return context\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}