(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6085,e=>{"use strict";var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let t=r.fetch,s=r.fetch.bind(r),a=r.Headers,o=r.Request,u=r.Response;e.s(["Headers",0,a,"Request",0,o,"Response",0,u,"default",0,s,"fetch",0,t])},57951,e=>{"use strict";var r=e.i(43476),t=e.i(71645);e.i(3905);var s=e.i(11795);let a=(0,t.createContext)(void 0);function o({children:e}){let[o,u]=(0,t.useState)(null),[n,i]=(0,t.useState)(null),[l,c]=(0,t.useState)(!0),[h,d]=(0,t.useState)(null),[f,p]=(0,t.useState)(null),w=async e=>{try{let{data:r,error:t}=await s.supabase.rpc("get_my_profile");if(!t&&r){let e=Array.isArray(r)?r[0]:r;if(e){d(e.workspace_id),p(e.role);return}}let{data:a,error:o}=await s.supabase.from("users").select("workspace_id, role").eq("id",e).maybeSingle();if(o)throw o;if(!a){d(null),p(null);return}d(a.workspace_id),p(a.role)}catch(e){console.error("Error fetching user profile:",(e&&(e.message||e.code||e.status||e.details))??("string"==typeof e?e:JSON.stringify(e))),d(null),p(null)}};(0,t.useEffect)(()=>{(async()=>{try{let e=new Promise((e,r)=>setTimeout(()=>r(Error("Auth initialization timeout")),5e3)),r=s.supabase.auth.getSession(),{data:{session:t}}=await Promise.race([r,e]);i(t),u(t?.user??null),t?.user&&await w(t.user.id)}catch(e){console.error("Error initializing auth:",e),c(!1)}finally{c(!1)}})();let{data:{subscription:e}}=s.supabase.auth.onAuthStateChange(async(e,r)=>{console.log("Auth state changed:",e),i(r),u(r?.user??null),r?.user?await w(r.user.id):(d(null),p(null)),c(!1)});return()=>{e.unsubscribe()}},[]);let y=async(e,r,t)=>{try{let{data:a,error:o}=await s.supabase.auth.signUp({email:e,password:r,options:{data:{full_name:t}}});if(o)throw o;return{error:null}}catch(e){return console.error("Sign up error:",e),{error:e}}},g=async(e,r)=>{try{let{data:t,error:a}=await s.supabase.auth.signInWithPassword({email:e,password:r});if(a)throw a;return{error:null}}catch(e){return console.error("Sign in error:",e),{error:e}}},b=async()=>{try{await s.supabase.auth.signOut(),d(null),p(null)}catch(e){console.error("Sign out error:",e)}},S=async()=>{try{let{data:{session:e}}=await s.supabase.auth.getSession();i(e),u(e?.user??null),e?.user&&await w(e.user.id)}catch(e){console.error("Error refreshing session:",e)}};return(0,r.jsx)(a.Provider,{value:{user:o,session:n,loading:l,workspaceId:h,userRole:f,signUp:y,signIn:g,signOut:b,refreshSession:S},children:e})}function u(){let e=(0,t.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}e.s(["AuthProvider",()=>o,"useAuth",()=>u])},11737,e=>{e.v(e=>Promise.resolve().then(()=>e(6085)))}]);